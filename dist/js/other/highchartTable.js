!function(a){a.fn.highchartTable=function(){var i=["column","line","area","spline","pie"],r=function(e,t){var i=a(e).data(t);if("undefined"!=typeof i){for(var r=i.split("."),n=window[r[0]],d=1,l=r.length;d<l;d++)n=n[r[d]];return n}};return this.each(function(){var n,d=a(this),l=a(d),p=1,s=l.data("graph-title-text")||"";if(1!=l.data("graph-container-before")){var o=l.data("graph-container");if(!o)throw"graph-container data attribute is mandatory";if("#"===o[0]||o.indexOf("..")===-1)n=a(o);else{for(var h=d,g=o;g.indexOf("..")!==-1;)g=g.replace(/^.. /,""),h=h.parent();n=a(g,h)}if(1!==n.length)throw"graph-container is not available in this DOM or available multiple times";n=n[0]}else l.before("<div></div>"),n=l.prev(),n=n[0];var c=l.data("graph-type");if(!c)throw"graph-type data attribute is mandatory";if(a.inArray(c,i)==-1)throw"graph-container data attribute must be one of "+i.join(", ");var f=l.data("graph-stacking");f||(f="normal");var u=l.data("graph-datalabels-enabled"),x=1==l.data("graph-inverted"),y=a("thead th",d),b=[],m=[],v=0,k=!1;y.each(function(e,t){var r=a(t),n=r.data("graph-value-scale"),d=r.data("graph-type");a.inArray(d,i)==-1&&(d=c);var s=r.data("graph-stack-group");s&&(k=!0);var o=r.data("graph-datalabels-enabled");"undefined"==typeof o&&(o=u);var h=r.data("graph-yaxis");"undefined"!=typeof h&&"1"==h&&(p=2);var g=1==r.data("graph-skip");g&&(v+=1);var f={libelle:r.text(),skip:g,indexTd:e-v-1,color:r.data("graph-color"),visible:!r.data("graph-hidden"),yAxis:"undefined"!=typeof h?h:0,dashStyle:r.data("graph-dash-style")||"solid",dataLabelsEnabled:1==o,dataLabelsColor:r.data("graph-datalabels-color")||l.data("graph-datalabels-color")},y=r.data("graph-vline-x");"undefined"==typeof y?(f.scale="undefined"!=typeof n?parseFloat(n):1,f.graphType="column"==d&&x?"bar":d,f.stack=s,f.unit=r.data("graph-unit"),b[e]=f):(f.x=y,f.height=r.data("graph-vline-height"),f.name=r.data("graph-vline-name"),m[e]=f)});var w=[];a(b).each(function(a,e){if(0!=a&&!e.skip){var t={name:e.libelle+(e.unit?" ("+e.unit+")":""),data:[],type:e.graphType,stack:e.stack,color:e.color,visible:e.visible,yAxis:e.yAxis,dashStyle:e.dashStyle,marker:{enabled:!0},dataLabels:{enabled:e.dataLabelsEnabled,color:e.dataLabelsColor,align:l.data("graph-datalabels-align")||("column"==c&&1==x?void 0:"center")}};if(e.dataLabelsEnabled){var i=r(d,"graph-datalabels-formatter");i&&(t.dataLabels.formatter=function(){return i(this.y)})}w.push(t)}}),a(m).each(function(a,e){"undefined"==typeof e||e.skip||w.push({name:e.libelle,data:[{x:e.x,y:0,name:e.name},{x:e.x,y:e.height,name:e.name}],type:"spline",color:e.color,visible:e.visible,marker:{enabled:!0}})});var T=[],L=r(d,"graph-point-callback"),O="datetime"==l.data("graph-xaxis-type"),I=a("tbody:first tr",d);I.each(function(e,i){if(!a(i).data("graph-skip")){var r=a("td",i);r.each(function(e,r){var n,d=b[e];if(!d.skip){var l=a(r);if(0==e)n=l.text(),T.push(n);else{var p=l.text(),s=w[d.indexTd];if(0==p.length)O||s.data.push(null);else{var o=p.replace(/ /g,"").replace(/,/,".");n=Math.round(parseFloat(o)*d.scale*100)/100;var h=l.data("graph-x");if(O){h=a("td",a(i)).first().text();var g=t(h);h=g.getTime()-60*g.getTimezoneOffset()*1e3}var c=l.data("graph-name"),f={name:"undefined"!=typeof c?c:p,y:n,x:h};L&&(f.events={click:function(){return L(this)}}),"pie"===d.graphType&&l.data("graph-item-highlight")&&(f.sliced=1);var u=l.data("graph-item-color");"undefined"!=typeof u&&(f.color=u),s.data.push(f)}}}})}});var z,A=[];for(z=1;z<=p;z++){var S={allowDecimals:!1,title:{text:"undefined"!=typeof l.data("graph-yaxis-"+z+"-title-text")?l.data("graph-yaxis-"+z+"-title-text"):null},max:"undefined"!=typeof l.data("graph-yaxis-"+z+"-max")?l.data("graph-yaxis-"+z+"-max"):null,min:"undefined"!=typeof l.data("graph-yaxis-"+z+"-min")?l.data("graph-yaxis-"+z+"-min"):null,reversed:"1"==l.data("graph-yaxis-"+z+"-reversed"),opposite:"1"==l.data("graph-yaxis-"+z+"-opposite"),tickInterval:l.data("graph-yaxis-"+z+"-tick-interval")||null,labels:{rotation:l.data("graph-yaxis-"+z+"-rotation")||0},startOnTick:"0"!==l.data("graph-yaxis-"+z+"-start-on-tick"),endOnTick:"0"!==l.data("graph-yaxis-"+z+"-end-on-tick"),stackLabels:{enabled:"1"==l.data("graph-yaxis-"+z+"-stacklabels-enabled")},gridLineInterpolation:l.data("graph-yaxis-"+z+"-grid-line-interpolation")||null},C=r(d,"graph-yaxis-"+z+"-formatter-callback");C&&(S.labels.formatter=function(){return C(this.value)}),A.push(S)}for(var D=["#4298cc","#97daea","#6cc5e9","#dad2c7","#c6b9ad","#cce981","#6bc04b","#6cc5e9"],H=[],W="undefined"!=typeof Highcharts.theme&&"undefined"!=typeof Highcharts.theme.colors?Highcharts.theme.colors:[],F=l.data("graph-line-shadow"),E=l.data("graph-line-width")||2,P=0;P<D.length;P++){var j="graph-color-"+(P+1);H.push("undefined"!=typeof l.data(j)?l.data(j):"undefined"!=typeof W[P]?W[P]:D[P])}var B=l.data("graph-margin-top"),G=l.data("graph-margin-right"),M=l.data("graph-margin-bottom"),R=l.data("graph-margin-left"),Q=l.data("graph-xaxis-labels-enabled"),_={},q=l.data("graph-xaxis-labels-font-size");"undefined"!=typeof q&&(_.fontSize=q);var J={colors:H,chart:{renderTo:n,inverted:x,marginTop:"undefined"!=typeof B?B:null,marginRight:"undefined"!=typeof G?G:null,marginBottom:"undefined"!=typeof M?M:null,marginLeft:"undefined"!=typeof R?R:null,spacingTop:l.data("graph-spacing-top")||10,height:l.data("graph-height")||null,zoomType:l.data("graph-zoom-type")||null,polar:l.data("graph-polar")||null},title:{text:s},subtitle:{text:l.data("graph-subtitle-text")||""},legend:{enabled:"1"!=l.data("graph-legend-disabled"),layout:l.data("graph-legend-layout")||"horizontal",symbolWidth:l.data("graph-legend-width")||30,x:l.data("graph-legend-x")||15,y:l.data("graph-legend-y")||0},xAxis:{categories:"datetime"!=l.data("graph-xaxis-type")?T:void 0,type:"datetime"==l.data("graph-xaxis-type")?"datetime":void 0,reversed:"1"==l.data("graph-xaxis-reversed"),opposite:"1"==l.data("graph-xaxis-opposite"),showLastLabel:"undefined"==typeof l.data("graph-xaxis-show-last-label")||l.data("graph-xaxis-show-last-label"),tickInterval:l.data("graph-xaxis-tick-interval")||null,dateTimeLabelFormats:{second:"%e. %b",minute:"%e. %b",hour:"%e. %b",day:"%e. %b",week:"%e. %b",month:"%e. %b",year:"%e. %b"},labels:{enabled:"undefined"==typeof Q||Q,style:_},startOnTick:l.data("graph-xaxis-start-on-tick"),endOnTick:l.data("graph-xaxis-end-on-tick"),min:e(d,"min"),max:e(d,"max"),alternateGridColor:l.data("graph-xaxis-alternateGridColor")||null,title:{text:l.data("graph-xaxis-title-text")||null},gridLineWidth:l.data("graph-xaxis-gridLine-width")||0,gridLineDashStyle:l.data("graph-xaxis-gridLine-style")||"ShortDot",tickmarkPlacement:l.data("graph-xaxis-tickmark-placement")||"between",lineWidth:l.data("graph-xaxis-line-width")||0},yAxis:A,tooltip:{formatter:function(){if("datetime"==l.data("graph-xaxis-type"))return"<b>"+this.series.name+"</b><br/>"+Highcharts.dateFormat("%e. %b",this.x)+" : "+this.y;var a="undefined"!=typeof T[this.point.x]?T[this.point.x]:this.point.x;return"pie"===c?"<strong>"+this.series.name+"</strong><br />"+a+" : "+this.point.y:"<strong>"+this.series.name+"</strong><br />"+a+" : "+this.point.name}},credits:{enabled:!1},plotOptions:{line:{dataLabels:{enabled:!0},lineWidth:E},area:{lineWidth:E,shadow:"undefined"==typeof F||F,fillOpacity:l.data("graph-area-fillOpacity")||.75},pie:{allowPointSelect:!0,dataLabels:{enabled:!0},showInLegend:"1"==l.data("graph-pie-show-in-legend"),size:"80%"},series:{animation:!1,stickyTracking:!1,stacking:k?f:null,groupPadding:l.data("graph-group-padding")||0}},series:w,exporting:{filename:s.replace(/ /g,"_"),buttons:{exportButton:{menuItems:null,onclick:function(){this.exportChart()}}}}};l.trigger("highchartTable.beforeRender",J),new Highcharts.Chart(J)}),this};var e=function(e,i){var r=a(e).data("graph-xaxis-"+i);if("undefined"!=typeof r){if("datetime"==a(e).data("graph-xaxis-type")){var n=t(r);return n.getTime()-60*n.getTimezoneOffset()*1e3}return r}return null},t=function(a){var e=a.split(" "),t=e[0].split("-"),i=null,r=null;if(e[1]){var n=e[1].split(":");i=parseInt(n[0],10),r=parseInt(n[1],10)}return new Date(parseInt(t[0],10),parseInt(t[1],10)-1,parseInt(t[2],10),i,r)}}(jQuery);
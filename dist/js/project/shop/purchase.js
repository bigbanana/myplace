/* build : 564493634@qq.com 2015-04-24 10:10:37 */
define(["jquery","underscore","backbone","backbone.epoxy","jquery.validate","jquery.ui"],function(t){function s(){var s=t("#parent");s.on("change",function(){show_child(this.value,"purchase_category")}),window.show_child=function(s,a){s>0?t.post(AJAX.linkage,{table:a,pid:s},function(s){t("#child").remove();var a='<select name="category" id="child">',e="";t.each(s,function(t,s){e+='<option value="'+s.id+'">'+s.name+"</option>"});var a=a+e+"</select>";s.length>0&&t("#st-category select").after(a)},"json"):t("#child").remove()},window.saveaddr=function(){var s=t("input[name=contact]").val(),a=t("input[name=mobi]").val(),e=t("input[name=tel]").val(),n=t("input[name=email]").val(),i=t("input[name=address]").val(),c=t("input[name=company]").val(),l=t("input[name=postcode]").val(),o=t("input[name=address_id]:checked").val(),d=t("input[name=uid]").val();t.post(AJAX.save_address,{id:o,user_id:d,contact:s,mobi:a,tel:e,email:n,address:i,company:c,postcode:l},function(t){alert(1==t.status?"保存成功！":"保存失败！")},"json")},t(document.body).on("click",".change_address_a",function(){obj=t(this),t(".change_address_a").attr("isad",0),t(".contacts").remove(),t("#anonymous-contact").hide(),1!=obj.attr("isad")&&t.post(AJAX.edit_address,{id:t(this).attr("data")},function(t){null==t.contact?t.contact="":"",null==t.mobi?t.mobi="":"",null==t.tel?t.tel="":"",null==t.email?t.email="":"",null==t.address?t.address="":"",null==t.company?t.company="":"",null==t.postcode?t.postcode="":"";var s='<div class="contacts edit-contacts"> <div class="st">  <span class="st-span"><b>*</b>联系人：</span>  <div class="st-ifo"><input class="text" type="text" name="contact" value="'+t.contact+'"></div> </div> <div class="st">  <span class="st-span"><b>*</b>手机号码：</span>  <div class="st-ifo"><input class="text" type="text" name="mobi" value="'+t.mobi+'"></div>  </div> <div class="st"><span class="st-span">或固定电话</span>  <div class="st-ifo">  <input class="text" type="text" name="tel" value="'+t.tel+'"></div> </div> <div class="st">  <span class="st-span"><b>*</b>E-mail：</span>  <div class="st-ifo">  <input class="text" type="text" name="email" value="'+t.email+'"> </div> </div> <div class="st">  <span class="st-span">联系地址：</span>  <div class="st-ifo">  <input class="text" type="text" name="address" value="'+t.address+'">  </div> </div> <div class="st">  <span class="st-span">所属单位：</span>  <div class="st-ifo">  <input class="text" type="text" name="company" value="'+t.company+'">  </div> </div> <div class="st">  <span class="st-span">邮编：</span>  <div class="st-ifo">  <input class="text" type="text" name="postcode" value="'+t.postcode+'">  </div> <div class="st"><span class="st-span">&nbsp;</span><input class="button saveaddress" type="button" value="保存" onclick="saveaddr();"></div></div> </div>';obj.attr("isad",1),obj.parent(".tit-contact").after(s),obj.parent(".tit-contact").find(".tit-contact-input").attr("checked","checked")},"json")}),t("#new_address").click(function(){if(t(".contacts").remove(),0==t("ano-contacts").length){var s='<div class="contacts ano-contacts"> <div class="st">  <span class="st-span"><b>*</b>联系人：</span>  <div class="st-ifo"><input class="text" type="text" name="contact" value=""></div> </div> <div class="st">  <span class="st-span"><b>*</b>手机号码：</span>  <div class="st-ifo"><input class="text" type="text" name="mobi" value=""></div> </div><div class="st"><span class="st-span">或固定电话</span>  <div class="st-ifo">  <input class="text" type="text" name="tel" value=""></div> </div> <div class="st">  <span class="st-span"><b>*</b>E-mail：</span>  <div class="st-ifo">  <input class="text" type="text" name="email" value=""> </div> </div> <div class="st">  <span class="st-span">联系地址：</span>  <div class="st-ifo">  <input class="text" type="text" name="address" value="">  </div> </div> <div class="st">  <span class="st-span">所属单位：</span>  <div class="st-ifo">  <input class="text" type="text" name="company" value="">  </div> </div> <div class="st">  <span class="st-span">邮编：</span>  <div class="st-ifo">  <input class="text" type="text" name="postcode" value="">  </div> </div> </div>';t(".anonymous-contact").after(s)}else alert(t("ano-contacts").length)}),t(function(){ueditor=UE.getEditor("ueditor_contents"),ueditor.addListener("contentChange",function(){ueditor.sync(),t(this.textarea).valid()});var s=UE.getEditor("ueditor_upload");t(".prev").on("click",".cancel",function(){t(this).parents("li").remove()}),t("body").on("mouseenter mouseleave",".prev li",function(){t(this).find(".file-panel").toggle(1)}),s.ready(function(){s.hide(),s.addListener("beforeInsertImage",function(s,a){return a.length>5?(alert("最多上传5张图片"),!1):void t.each(a,function(s,a){t(".prev").append('<li><img src="'+a.src+'" /><div class="file-panel"><span class="cancel"></span></div><input type="hidden" name="pictures[]" value="'+a.src+'" /></li>')})})}),t(".upload").on("click",function(){s.getDialog("insertimage").open(),t(this).nextAll(".error").remove()});var a=t(".publish-form"),e=a.validate({ignore:"input[type=file],.ignore"});a.on("submit",function(){var s=a.find('input[name="pictures[]"]');if(!s.length){var n=t(".upload").nextAll(".error");return n.length||t(".upload").after('<span class="error">相关图片不能为空</span>'),!1}return e.form()?void 0:!1})})}function a(){t(function(){t(".copy").click(function(){t("#webaddr").select(),document.execCommand("Copy"),alert("复制成功")})})}return{release:s,edit:s,releaseSuccess:a}});
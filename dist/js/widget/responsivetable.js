/* build : 564493634@qq.com 2015-05-07 13:23:46 */
define("widget.responsivetable",["jquery","underscore","browser","jquery.ui","jquery.dropdown"],function(t,e,i){return t.widget("custom.responsivetable",{options:{stickyHeaderOffset:0},_create:function(){this.element.addClass("responsive-table").wrap('<div class="responsive-table-wrapper"/>'),this.$wrap=this.element.parent(),this.$table=this.$tables=this.element.find(">table"),this.$head=this.$table.find("thead"),this.$body=this.$table.find("tbody"),this.initColumn(),this.createToolbar(),this.createStickyHeader(),this.events(),this.updateCheckState()},events:function(){var i=this;this.$toolbar.on("change","input[type=checkbox]",function(){var e=t(this),s=e.prop("checked"),n=parseInt(e.val())+1,o=i.$tables.find("tr>:nth-child("+n+")");o.toggleClass("show",s).toggleClass("hide",!s)}),t(window).on("resize",function(){e.delay(function(){i.$sticky.css({width:i.element.width()})},0),i.windowResize()}),this.element.on("scroll",function(){i.$sticky.scrollLeft(i.element.scrollLeft())}),this.$checkGroup.on("click",function(t){t.stopPropagation()}),this.$toolbar.on("click","button[data-action=show-all]",function(){i.$checkGroup.find("input[type=checkbox]:not(:checked)").prop("checked",!0).trigger("change")})},initColumn:function(){var e=this;this.$head.find("th").each(function(){var e=t(this),i=e.data();i.priority=i.priority||1}),this.$body.children().each(function(){t(this).children().each(function(i){var s=t(this),n=e.$head.find("th").eq(i).data();s.addClass("priority"+n.priority)})})},createToolbar:function(){this.$toolbar=t(this._tollbarTemp()),this.element.before(this.$toolbar),this.createCheckGroup()},createCheckGroup:function(){var i=this;this.$checkGroup=t('<ul class="dropdown-menu">').appendTo(this.$toolbar.find(".dropdown")),this.$head.find("th").each(function(s){var n=t(this),o=n.data();n.data("priority",o.priority||1),o=n.data(),n.addClass("priority"+o.priority),e.extend(o,{_text:n.text(),_index:s});var a=t(i._liTemp(o));i.$checkGroup.append(a)})},updateCheckState:function(){var e=this;this.$checkGroup.children().each(function(){var i=t(this),s=i.find("input[type=checkbox]"),n=e.$head.find("th:eq("+s.val()+")");s.prop("checked","none"!=n.css("display"))})},createStickyHeader:function(){if(7>i)return void(this.$sticky=t("<div>"));var e=this,s=this.$table.clone();this.$tables=this.$tables.add(s),this.$sticky=t('<div class="sticky-table-header">').append(s),this.$table.before(this.$sticky),this.$sticky.css({height:this.$head.height()+1,width:this.element.width(),top:this.options.stickyHeaderOffset,visibility:"hidden"}),require(["jquery.waypoints"],function(){e.element.waypoint({offset:e.options.stickyHeaderOffset,handler:function(t){e.$sticky.css("down"==t?{visibility:"visible",position:"fixed"}:{visibility:"hidden"})}})})},windowResize:e.debounce(function(){i>8&&(this.$table.find("tr>.show").removeClass("show"),this.$table.find("tr>.hide").removeClass("hide")),this.updateCheckState()},200),widget:function(){return this.$wrap},_liTemp:e.template(['<li><label><input type="checkbox" name="column" value="<%=_index%>" /> <%= _text %></label></li>'].join("")),_tollbarTemp:e.template(['<div class="responsive-table-toolbar">','<div class="btn-group dropdown">','<button class="btn" data-action="show-all">显示全部</button>',' <button class="btn dropdown-toggle" data-toggle="dropdown">显示</button>',"</div>","</div>"].join(""))}),t});